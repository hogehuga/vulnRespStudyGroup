# Windows EventLogからAPTを見つける

## 概要

Windows Eventlogを使って、APTエミュレーションでの攻撃を見つけるトレーニングをしたい。
ゴールとしては、フォレンジックに出す前のPre調査程度を想定する。

内包する技術は以下の通り。

- Windows EventLogのログ出力設定について、一定の理解
  - デフォルトでは追跡しきれない
  - どのように設定するのか
  - どのような設定にするのか
  - sysmonの助けを借りる
    - 設定はどうすべきか
- Windows EventLogから、不正なものを見つける
  - Hayabusa辺りを利用して、目星を付ける
    - 何をもって問題があるログとするかを、Hayabusaのログから学ぶ
  - 目星をつけた対象を、実際のログで前後を確認する
  - 感染の開始時刻を見つける（APTエミュレーションを実行した時刻）
  - EventLogの調整とsysmon導入をしたもの/していないもの、の双方のログで対応できるか確認する

## ロードマップ

- Windows EventLogでマルウェア等の感染を見つける方法の概略を伝える
  - ログ戦略の概要を伝える
    - デフォルトでは必要なものが出ない
    - ログが出るように設定をする必要がある
      - EventLog(ローカル部ループポリシーの設定(gpedit.msc))
      - sysomn(プロセスの追跡とsysmon)
  - ログからどうやって追うのか
    - ログをそのまま見ても難しい
      - パターンを知らないと異常と認識できない、量が多すぎる
    - ツールで異常値を自動で見つけるのが良いかもしれない
      - SIGMAルールみたいなのが必要よね
      - なんか色々使った感じだと個人的にHayabusaが良かったからそれで。
- (OPTIONAL) 自身で用意したWindows仮想マシンに、EventLog/sysmonの設定をする
  - (OPTIONAL) 同Windwosに、APTエミュレータで自分で攻撃し、侵害時のイベントログを用意する
- 「デフォルトのログ設定のままAPTエミュレーションで感染させた」ログを見る
  - (ログは開催側で用意)
  - Hayabusa等の導入トレーニングとして、まずは見てもあまり情報が得られないがやる
  - ログがデフォルト状態だと、次に実施する設定後のログのような調査ができないことを実感して頂く
- 「それなりにきちんとログ出力設定した」ログを見る
  - (ログは開催側で用意)
  - ツールで見て、実際のログを追いかける

## 実現方法

- EventLogの用意
  - 今回は「解析」を主眼に置くので、解析対象ログを用意する
    - デフォルトのまま感染
    - それなりに設定した状態で感染
- 手順の作成
  - Hayabusaの導入は、ある程度コンピュータに慣れていないと難しい場合がある
  - 手順 = ログ解析勉強会の講義スライド、にもなるので

## 検討方法

- 準備しろ
  - 以上。
- 大和セキュリティのザックさんに確認が必要かも
  - パクリ…になってしまう可能性がある
    - 元から考えていたけど、ザックさんの勉強会で実現したいことと同じことがなされて、受講した
    - 先方に迷惑をかけたくないので、必要に応じて色々変更する
      - 説明資料はパクりませんよ、もちろん…
      - Hayabusaの使い方回、みたいな立ち位置にしてもよいかも